gate:prerelease:
  extends:
    - .gate_base
  stage: prerelease
  when: on_success
  rules:
    - if: $RP_PUBLISH_DISABLED == 'true'
      when: never
    - if: $CI_COMMIT_REF_NAME

.publish:alpha:needs:
  needs:
    - job: 'set:version'
    - job: 'gate:preconditions'
    - job: 'build:alpha'
      optional: true
    - job: 'gate:prerelease'

.publish:alpha:
  variables:
    PUBLISH_TYPE: 'alpha'
  needs:
    - !reference [.publish:alpha:needs, needs]

publish:alpha:
  extends:
    - .publish_base
    - .publish
    - .publish:alpha
    - .publish:override
  stage: prerelease
  rules:
    - if: $RP_PUBLISH_DISABLED == 'true'
      when: never
    - !reference [.non-release_rules, rules]

.publish:debug:needs:
  needs:
    - job: 'set:version'
    - job: 'gate:preconditions'
    - job: 'build:debug'
      optional: true
    - job: 'gate:prerelease'

.publish:debug:
  variables:
    PUBLISH_TYPE: 'debug'
  needs:
    - !reference [.publish:debug:needs, needs]

publish:debug:
  extends:
    - .publish_base
    - .publish
    - .publish:debug
    - .publish:override
  stage: prerelease
  rules:
    - if: $RP_PUBLISH_DISABLED == 'true'
      when: never
    - if: $RP_DEBUG_BUILD_DISABLED == 'true'
      when: never
    - if: $CI_COMMIT_REF_NAME
